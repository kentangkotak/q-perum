import { boot } from 'quasar/wrappers'
import Echo from 'laravel-echo'
import Pusher from 'pusher-js'
import { useNotificationStore } from 'src/stores/notifications'

window.Pusher = Pusher

export default boot(() => {
  const echo = new Echo({
    broadcaster: 'pusher',
    key: 'local',
    wsHost: '192.168.33.101',
    wsPort: 6001,
    forceTLS: false,
    disableStats: true,
    encrypted: false,
  })

  window.Echo = echo

  const store = useNotificationStore()

  echo.connector.pusher.connection.bind('connected', () => {
    console.log('âœ… WebSocket connected:', echo.connector.pusher.connection.socket_id)
  })

  const channel = echo.channel('test-channel')
  channel.listen('TestEvent', (e) => {
    console.log('ğŸ“© Event received:', e)
    store.addMessage(e.message) // simpan di store
  })

  channel.subscribed(() => {
    console.log('âœ… Subscribed to test-channel')
  })

  channel.listen('TestEvent', (e) => {
    console.log('ğŸ“© Event received:', e)
    store.addMessage(e.message) // kirim ke store
  })
})
